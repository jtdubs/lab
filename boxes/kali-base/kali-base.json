{
    "variables": {
        "ova_path": "input/kali-linux-2020.3-vbox-amd64.ova",
        "vmx_path": "output-kali-converted/Kali-Linux-2020.3-vmware-amd64.vmx"
    },

    "builders": [
        {
            "type": "vmware-vmx",
            "source_path": "{{ user `vmx_path` }}",
            "disk_type_id": 0,
            "vmdk_name": "disk",
            "shutdown_command": "echo kali | sudo -S systemctl poweroff -i",
            "headless": false,
            "communicator": "ssh",
            "ssh_username": "kali",
            "ssh_password": "kali",
            "ssh_timeout": "2m",
            "vm_name": "kali-base",
            "boot_wait": "2s",
            "boot_command": [
                "<esc>e",
                "<down><down><down><down><down><down><down><down><down><down><down><down><down><down><end>",
                " 3",
                "<f10>",
                "<wait20>",
                "kali<enter>kali<enter><wait>",
                "echo kali | sudo -S systemctl start ssh<enter>"
            ]
        },
        {
            "type": "virtualbox-ovf",
            "source_path": "{{ user `ova_path` }}",
            "shutdown_command": "echo kali | sudo -S systemctl poweroff -i",
            "headless": false,
            "communicator": "ssh",
            "ssh_username": "kali",
            "ssh_password": "kali",
            "ssh_timeout": "2m",
            "vm_name": "kali-base",
            "boot_wait": "2s",
            "boot_command": [
                "<esc>e",
                "<down><down><down><down><down><down><down><down><down><down><down><down><down><down><end>",
                " 3",
                "<f10>",
                "<wait20>",
                "kali<enter>kali<enter><wait>",
                "echo kali | sudo -S systemctl start ssh<enter>"
            ]
        }
    ],

    "provisioners": [
        {
            "type": "file",
            "sources": [
                "../../vagrant.id_rsa.pub",
                "../../packer.id_rsa.pub"
            ],
            "destination": "/tmp/"
        },
        {
            "type": "shell",
            "only": "vmware-vmx",
            "execute_command": "echo kali | sudo -S bash '{{ .Path }}'",
            "script": "scripts/install.sh"
        }
    ],

    "post-processors": [
        {
            "type": "shell-local",
            "inline": [
                "ssh-keygen -R {{ build `Host` }}"
            ]
        }
    ]
}
